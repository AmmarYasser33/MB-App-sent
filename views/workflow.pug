doctype html
html.light-style.layout-navbar-fixed.layout-menu-fixed(lang="en", dir="ltr", data-theme="theme-default", data-assets-path="assets/", data-template="vertical-menu-template-no-customizer-starter")
  head
    meta(charset="utf-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0")
    title Workflow | MB App
    meta(name="description", content="")
    // Favicon
    link(rel="icon", type="image/x-icon", href="/assets/img/favicon/favicon.ico")
    // Fonts
    link(rel="preconnect", href="https://fonts.googleapis.com")
    link(rel="preconnect", href="https://fonts.gstatic.com", crossorigin)
    link(href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap", rel="stylesheet")
    // Icons
    link(rel="stylesheet", href="/assets/vendor/fonts/fontawesome.css")
    link(rel="stylesheet", href="/assets/vendor/fonts/tabler-icons.css")
    link(rel="stylesheet", href="/assets/vendor/fonts/flag-icons.css")
    // Core CSS
    link(rel="stylesheet", href="/assets/vendor/css/rtl/core.css")
    link(rel="stylesheet", href="/assets/vendor/css/rtl/theme-default.css")
    link(rel="stylesheet", href="/assets/css/demo.css")
    // Vendors CSS
    link(rel="stylesheet", href="/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css")
    link(rel="stylesheet", href="/assets/vendor/libs/node-waves/node-waves.css")
    link(rel="stylesheet", href="/assets/vendor/libs/typeahead-js/typeahead.css")
    link(rel="stylesheet", href="/assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css")
    link(rel="stylesheet", href="/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css")
    link(rel="stylesheet", href="/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css")
    link(rel="stylesheet", href="/assets/vendor/libs/select2/select2.css")
    link(rel="stylesheet", href="/assets/vendor/libs/formvalidation/dist/css/formValidation.min.css")
    // Page CSS
    link(rel="stylesheet", href="/css/app-styles.css")
    // Helpers
    script(src="/assets/vendor/js/helpers.js")
    // ! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section
    // ? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.
    script(src="/assets/js/config.js")
  body
    // Layout wrapper
    .layout-wrapper.layout-content-navbar
      .layout-container
        // Menu
        aside#layout-menu.layout-menu.menu-vertical.menu.bg-menu-theme
          .app-brand.demo
            a.app-brand-link(href="/index")
              span.app-brand-logo.demo
                svg(width="32", height="22", viewBox="0 0 32 22", fill="none", xmlns="http://www.w3.org/2000/svg")
                  path(fill-rule="evenodd", clip-rule="evenodd", d="M0.00172773 0V6.85398C0.00172773 6.85398 -0.133178 9.01207 1.98092 10.8388L13.6912 21.9964L19.7809 21.9181L18.8042 9.88248L16.4951 7.17289L9.23799 0H0.00172773Z", fill="#00718a")
                  path(opacity="0.06", fill-rule="evenodd", clip-rule="evenodd", d="M7.69824 16.4364L12.5199 3.23696L16.5541 7.25596L7.69824 16.4364Z", fill="#161616")
                  path(opacity="0.06", fill-rule="evenodd", clip-rule="evenodd", d="M8.07751 15.9175L13.9419 4.63989L16.5849 7.28475L8.07751 15.9175Z", fill="#161616")
                  path(fill-rule="evenodd", clip-rule="evenodd", d="M7.77295 16.3566L23.6563 0H32V6.88383C32 6.88383 31.8262 9.17836 30.6591 10.4057L19.7824 22H13.6938L7.77295 16.3566Z", fill="#00718a")
              span.app-brand-text.demo.menu-text.fw-bold MB App
            a.layout-menu-toggle.menu-link.text-large.ms-auto(href="javascript:void(0);")
              i.ti.menu-toggle-icon.d-none.d-xl-block.ti-sm.align-middle
              i.ti.ti-x.d-block.d-xl-none.ti-sm.align-middle
          .menu-inner-shadow
          ul.menu-inner.py-1
            // Dashboards
            li.menu-item.open
              a.menu-link(href="/index")
                i.menu-icon.tf-icons.ti.ti-smart-home
                div(data-i18n="Dashboards") Dashboards
            // Assistant
            li.menu-header.small.text-uppercase
              span.menu-header-text Assistant
            li.menu-item.active
              a.menu-link.active(href="/workflow")
                i.menu-icon.tf-icons.ti.ti-text-wrap-disabled
                div(data-i18n="Workflow") Workflow
            // Maintenance Base
            li.menu-header.small.text-uppercase
              span.menu-header-text Maintenance Base
            li.menu-item
              a.menu-link(href="/cars")
                i.menu-icon.tf-icons.ti.ti-brand-toyota
                div(data-i18n="Cars") Cars
            li.menu-item
              a.menu-link(href="/warehouse")
                i.menu-icon.tf-icons.ti.ti-building-warehouse
                div(data-i18n="Warehouse") Warehouse
            // Team Management
            - if (loggedUser.role === 'team-leader' || loggedUser.role === 'assistant')
              li.menu-header.small.text-uppercase
                span.menu-header-text Team Management
              li.menu-item
                a.menu-link(href="/team")
                  i.menu-icon.tf-icons.ti.ti-users
                  div(data-i18n="Team") Team
            // Support
            li.menu-header.small.text-uppercase
              span.menu-header-text Issues
            li.menu-item
              a.menu-link(href="#")
                i.menu-icon.tf-icons.ti.ti-message-report
                div(data-i18n="Support") Support
            li.menu-header.small.text-uppercase
              span.menu-header-text MB App V1.0
        // / Menu
        // Layout container
        .layout-page
          // Navbar
          nav#layout-navbar.layout-navbar.container-xxl.navbar.navbar-expand-xl.navbar-detached.align-items-center.bg-navbar-theme
            .layout-menu-toggle.navbar-nav.align-items-xl-center.me-3.me-xl-0.d-xl-none
              a.nav-item.nav-link.px-0.me-xl-4(href="javascript:void(0)")
                i.ti.ti-menu-2.ti-sm
            #navbar-collapse.navbar-nav-right.d-flex.align-items-center
              .navbar-nav.align-items-center
                a.nav-link.style-switcher-toggle.hide-arrow(href="javascript:void(0);")
                  i.ti.ti-sm
              ul.navbar-nav.flex-row.align-items-center.ms-auto
                // User
                li.nav-item.navbar-dropdown.dropdown-user.dropdown
                  a.nav-link.dropdown-toggle.hide-arrow(href="javascript:void(0);", data-bs-toggle="dropdown")
                    i.fa-regular.fa-2x.fa-circle-user
                  ul.dropdown-menu.dropdown-menu-end
                    li
                      a.dropdown-item(href="#")
                        .d-flex
                          .flex-shrink-0.me-3
                            i.fa-regular.fa-2x.fa-circle-user
                          .flex-grow-1
                            - const loggedRole = loggedUser.role.replace(/-/g, " ").split(" ").map(word=>word.charAt(0).toUpperCase() + word.slice(1)).join(" ");
                            span.fw-semibold.d-block= `${loggedUser.name}`
                            small.text-muted= `${loggedRole}`
                    li
                      .dropdown-divider
                    li
                      a#logoutUserBtn.dropdown-item(href="#")
                        i.ti.ti-logout.me-2.ti-sm
                        span.align-middle Log Out
                // / User
          // / Navbar
          // Content wrapper
          .content-wrapper
            // Content
            .container-xxl.flex-grow-1.container-p-y
              .card
                .card-header.flex-column.flex-md-row
                  .head-label.text-start
                    h5.card-title.mb-0 Workflow Table
                  .dt-action-buttons.text-end.pt-3.pt-md-0
                    .dt-buttons
                      button.dt-button.create-new.btn.btn-primary(tabindex="0", aria-controls="DataTables_Table_0", type="button")
                        span
                          i.ti.ti-plus.me-sm-1
                          span.d-none.d-sm-inline-block(data-bs-toggle="modal", data-bs-target="#addWorkflow") Add New Record
                // Search Form
                .card-body
                  form(class="dt_adv_search", method="POST")
                    .row
                      .col-12
                        .row.g-3
                          .col-12.col-sm-6.col-lg-4
                            label.form-label Date:
                            input#dateFilter.form-control.dt-input.dt-full-name(type="date", data-column="1", placeholder="Date", data-column-index="0")
                          .col-12.col-sm-6.col-lg-4
                            label.form-label Work Order:
                            input#workOrderFilter.form-control.dt-input(type="number", data-column="2", placeholder="0001", data-column-index="1")
                          .col-12.col-sm-6.col-lg-4
                            label.form-label Site:
                            select#siteFilter.form-control.dt-input(placeholder="Choose Site")
                              option(value="") All
                              option(value="41") 41
                              option(value="42") 42
                              option(value="43") 43
                              option(value="44") 44
                              option(value="45") 45
                              option(value="47") 47
                              option(value="49") 49
                          .col-12.col-sm-6.col-lg-4
                            label.form-label Type:
                            select#typeFilter.form-control.dt-input(placeholder="Choose Status")
                              option(value="") All
                              option(value="PM") PM
                              option(value="CM") CM
                              option(value="Inspection") Inspection
                          .col-12.col-sm-6.col-lg-4
                            label.form-label(for="select2Multiple") Team:
                            select#select2Multiple.teamMembersFilter.select2.form-select(multiple="", data-select2-id="select2Multiple")
                              for employee in employeesList
                                option(value=employee.name)= employee.name

                          .col-12.col-sm-6.col-lg-4
                            label.form-label Status:
                            select#statusFilter.form-control.dt-input(placeholder="Choose Status")
                              option(value="") All
                              option(value="open") Open
                              option(value="under-observation") Under Observation
                              option(value="spare-part") Spare Part
                              option(value="closed") Closed
                hr.mt-0
                .card-datatable.table-responsive
                  table.dt-advanced-search.table
                    thead
                      tr
                        th Date
                        th Work Order
                        th Site
                        th Type
                        th Description
                        th Team
                        th L2 Support
                        th Status
                        th Action

                    for workflow in data
                      tr.odd.workflow-row
                        td= workflow.date
                        td= workflow.workorder
                        td= workflow.site
                        td
                          if workflow.type == "PM"
                            span.badge.bg-label-success= workflow.type
                          else if workflow.type == "Inspection"
                            span.badge.bg-label-warning= workflow.type
                          else if workflow.type == "CM"
                            span.badge.bg-label-danger= workflow.type
                        td= workflow.description
                        //- loop through team array and display it separated by |
                        td= workflow.team.join(" | ")
                        td= workflow.level2
                        td
                          if workflow.status.toLowerCase() == "open"
                            span.badge.bg-label-danger Open
                          else if workflow.status.toLowerCase() == "under-observation"
                            span.badge.bg-label-warning Under Observation
                          else if workflow.status.toLowerCase() == "spare-part"
                            span.badge.bg-label-primary Spare Part
                          else if workflow.status.toLowerCase() == "closed"
                            span.badge.bg-label-success Closed
                        td
                          a.btn.btn-sm.btn-icon.item-edit(data-bs-toggle="modal", data-bs-target="#editrecord")
                            i.text-primary.ti.ti-pencil

                    tfoot
                      tr
                        th Date
                        th Work Order
                        th Site
                        th Type
                        th Description
                        th Team
                        th L2 Support
                        th Status
                        th Action
              // / Advanced Search
            // / Content
            #addWorkflow.modal.fade(tabindex="-1", aria-hidden="true")
              .modal-dialog.modal-lg.modal-simple.modal-edit-user
                .modal-content.p-3.p-md-5
                  .modal-body
                    button.btn-close(type="button", data-bs-dismiss="modal", aria-label="Close")
                    .text-center.mb-4
                      h3.mb-2 Add New Record
                      p.text-muted Add new activity to the workflow.
                    form#addWorkflowForm.row.g-3.fv-plugins-bootstrap5.fv-plugins-framework(onsubmit="return false", novalidate="novalidate", data-select2-id="addWorkflowForm")
                      .col-12.col-md-6
                        label.form-label(for="addDate") Activity Date
                        input#addDate.form-control.dt-input.dt-full-name(type="date", name="Date")
                      .col-12.col-md-6
                        label.form-label(for="WorkflowTeams") Team
                        select#addselect2Multiple.select2.form-select(multiple="", data-select2-id="addteam")
                          for employee in employeesList
                            option(value=employee.name)= employee.name
                          
                      .col-12.col-md-6
                        label.form-label(for="addWorkflowworkorder") Work Order
                        input#addWorkflowworkorder.form-control(type="text", name="Workflowworkorder", placeholder="Work Order")
                      .col-12.col-md-6
                        label.form-label(for="addWorkflowSite") Site
                        select#addWorkflowSite.form-select(name="WorkflowSite", aria-label="Site")
                          option(value="")
                          option(value="41") 41
                          option(value="41-A") 41-A
                          option(value="41-B") 41-B
                          option(value="42") 42
                          option(value="43") 43
                          option(value="44") 44
                          option(value="45") 45
                          option(value="45-A") 45-A
                          option(value="45-B") 45-B
                          option(value="45-C") 45-C
                      .col-12.col-md-6
                        label.form-label(for="addWorkflowType") Type
                        select#addWorkflowType.form-select(name="WorkflowType", aria-label="Type")
                          option(value="")
                          option(value="CM") CM
                          option(value="PM") PM
                          option(value="Inspection") Inspection
                      .col-12.col-md-6
                        label.form-label(for="addWorkflowStatus") Status
                        select#addWorkflowStatus.form-select(name="WorkflowStatus", aria-label="Status")
                          option(value="")
                          option(value="open") Open
                          option(value="under-observation") Under Observation
                          option(value="spare-part") Spare Part
                          option(value="closed") Closed
                      .col-12.col-md-6
                        label.form-label(for="addWorkflowTimein") Time in
                        input#addWorkflowTimein.form-control(type="text", placeholder="00:00")
                      .col-12.col-md-6
                        label.form-label(for="addWorkflowTimeout") Time Out
                        input#addWorkflowTimeout.form-control(type="text", placeholder="23:59")
                      .col-12.col-md-6
                        label.form-label(for="addWorkflowDescription") Description
                        input#addWorkflowDescription.form-control(type="text", name="WorkflowDescription", placeholder="P01 Defect")
                      .col-12.col-md-6
                        label.form-label(for="addWorkflowCar") Car
                        select#addWorkflowCar.form-select(name="WorkflowCar", aria-label="Car")
                          option(value="")
                          for car in carsList
                            option(value=car.model+" "+car.year.slice(-2))= car.model+" "+car.year.slice(-2)

                 
                      .col-12.col-md-6
                        label.form-label(for="addWorkflowTeam") Responsible Team
                        select#addWorkflowTeam.form-select(name="WorkflowTeam", aria-label="Team")
                          option(value="")
                          option(value="Team A") Team A
                          option(value="Team B") Team B
                          option(value="Team C") Team C
                          option(value="Team D") Team D
                      .col-12.col-md-6
                        label.form-label(for="addWorkflowL2") L2 Support
                        select#addWorkflowL2.form-select(name="WorkflowL2", aria-label="L2")
                          option(value="")
                          option(value="Yes") Yes
                          option(value="No") No
                    .col-12.text-center
                      button#addWorkflowBtn.btn.btn-primary.me-sm-3.me-1.waves-effect.waves-light(type="submit") Add
                      button.btn.btn-label-secondary.waves-effect(type="reset", data-bs-dismiss="modal", aria-label="Close") Cancel
                    input(type="hidden")
            // / Content
            #editrecord.modal.fade(tabindex="-1", aria-hidden="true")
              .modal-dialog.modal-lg.modal-simple.modal-edit-user
                .modal-content.p-3.p-md-5
                  .modal-body
                    button.btn-close(type="button", data-bs-dismiss="modal", aria-label="Close")
                    .text-center.mb-4
                      h3.mb-2 Edit Record
                      p.text-muted Edit activity to the workflow.
                    form#editWorkflowForm.row.g-3.fv-plugins-bootstrap5.fv-plugins-framework(onsubmit="return false", novalidate="novalidate", data-select2-id="addWorkflowForm")
                      .col-12.col-md-6
                        label.form-label(for="Date") Activity Date
                        input#Date.form-control.dt-input.dt-full-name(type="date", value="2022-12-01", name="Date")
                      .col-12.col-md-6
                        label.form-label(for="WorkflowTeams") Team
                        select#select2Multiple.select2.form-select(multiple="", data-select2-id="editteam")
                          optgroup(label="Team A")
                            option(value="0111", data-select2-id="211") Mohammed Ahmed
                            option(value="0112", data-select2-id="222") Salih Mosleh
                          optgroup(label="Team B")
                            option(selected, value="0111", data-select2-id="333") Mohammed Ahmed
                            option(selected, value="0112", data-select2-id="444") Salih Mosleh
                          optgroup(label="Team C")
                            option(value="0111", data-select2-id="555") Mohammed Ahmed
                            option(value="0112", data-select2-id="666") Salih Mosleh
                          optgroup(label="Team D")
                            option(value="0111", data-select2-id="777") Mohammed Ahmed
                            option(value="0112", data-select2-id="888") Salih Mosleh
                      .col-12.col-md-6
                        label.form-label(for="Workflowworkorder") Work Order
                        input#Workflowworkorder.form-control(type="text", value="120982", name="Workflowworkorder", placeholder="Work Order")
                      .col-12.col-md-6
                        label.form-label(for="WorkflowSite") Site
                        select#WorkflowSite.form-select(name="WorkflowSite", aria-label="Site")
                          option(value="")
                          option(value="41") 41
                          option(value="41-A") 41-A
                          option(value="41-B") 41-B
                          option(value="42") 42
                          option(selected, value="43") 43
                          option(value="44") 44
                          option(value="45") 45
                          option(value="45-A") 45-A
                          option(value="45-B") 45-B
                          option(value="45-C") 45-C
                      .col-12.col-md-6
                        label.form-label(for="WorkflowType") Type
                        select#WorkflowType.form-select(name="WorkflowType", aria-label="Type")
                          option(value="")
                          option(selected, value="CM") CM
                          option(value="PM") PM
                          option(value="Inspection") Inspection
                      .col-12.col-md-6
                        label.form-label(for="WorkflowStatus") Status
                        select#WorkflowStatus.form-select(name="WorkflowStatus", aria-label="Status")
                          option(value="")
                          option(value="open") Open
                          option(value="under-observation") Under Observation
                          option(value="spare-part") Spare Part
                          option(selected, value="closed") Closed
                      .col-12.col-md-6
                        label.form-label(for="WorkflowTimein") Time in
                        input.form-control(type="text", value="21:11", placeholder="00:00")
                      .col-12.col-md-6
                        label.form-label(for="WorkflowTimeout") Time Out
                        input.form-control(type="text", value="23:44", placeholder="23:59")
                      .col-12.col-md-6
                        label.form-label(for="WorkflowDescription") Description
                        input#WorkflowDescription.form-control(type="text", value="P03 Not reach end position", name="WorkflowDescription", placeholder="P01 Defect")
                      .col-12.col-md-6
                        label.form-label(for="WorkflowCar") Car
                        select#WorkflowCar.form-select(name="WorkflowCar", aria-label="Car")
                          option(value="")
                          option(value="Parado 19") Parado 19
                          option(selected, value="Parado 20") Parado 20
                          option(value="Fortuner") Fortuner
                          option(value="Hilux") Hilux
                      .col-12.col-md-6
                        label.form-label(for="WorkflowTeam") Responsible Team
                        select#WorkflowTeam.form-select(name="WorkflowTeam", aria-label="Team")
                          option(value="")
                          option(value="Team A") Team A
                          option(selected, value="Team B") Team B
                          option(value="Team C") Team C
                          option(value="Team D") Team D
                      .col-12.col-md-6
                        label.form-label(for="WorkflowL2") L2 Support
                        select#WorkflowL2.form-select(name="WorkflowL2", aria-label="L2")
                          option(value="")
                          option(value="Yes") Yes
                          option(selected, value="No") No
                      .col-12.text-center
                        button.btn.btn-primary.me-sm-3.me-1.waves-effect.waves-light(type="submit") Add
                        button.btn.btn-label-secondary.waves-effect(type="reset", data-bs-dismiss="modal", aria-label="Close") Cancel
                      input(type="hidden")
            // Footer
            footer.content-footer.footer.bg-footer-theme
              .container-xxl
            // / Footer
            .content-backdrop.fade
          // Content wrapper
        // / Layout page
      // Overlay
      .layout-overlay.layout-menu-toggle
      // Drag Target Area To SlideIn Menu On Small Screens
      .drag-target
    // / Layout wrapper
    // Core JS
    script(src="/assets/vendor/js/core.js")
    script( src='https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.2/axios.min.js')
    script(type='module' src="/js/workflow.js")
    script(type='module' src="/js/logout.js")
    script(type='module' src="/js/workflowFilter.js")
